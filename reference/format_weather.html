<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Format weather data into a standardised format. — format_weather • epiphytoolR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Format weather data into a standardised format. — format_weather"><meta name="description" content="Formats raw weather data into an object suitable for use in the affiliated
spore dispersal packages such as ascotraceR and blackspot.sp. This
standardised data format ensures that the supplied weather data meet the
requirements for functions in the aforementioned packages. Input weather
data expects a 'long' data format, where each line is an observation at
a point in time."><meta property="og:description" content="Formats raw weather data into an object suitable for use in the affiliated
spore dispersal packages such as ascotraceR and blackspot.sp. This
standardised data format ensures that the supplied weather data meet the
requirements for functions in the aforementioned packages. Input weather
data expects a 'long' data format, where each line is an observation at
a point in time."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epiphytoolR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Format weather data into a standardised format.</h1>

      <div class="d-none name"><code>format_weather.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Formats raw weather data into an object suitable for use in the affiliated
spore dispersal packages such as <code>ascotraceR</code> and <code>blackspot.sp</code>. This
standardised data format ensures that the supplied weather data meet the
requirements for functions in the aforementioned packages. Input weather
data expects a 'long' data format, where each line is an observation at
a point in time.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">format_weather</span><span class="op">(</span></span>
<span>  <span class="va">w</span>,</span>
<span>  YYYY <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  MM <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  DD <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hh <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ss <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  POSIXct_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  time_zone <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">temp</span>,</span>
<span>  <span class="va">rain</span>,</span>
<span>  <span class="va">rh</span>,</span>
<span>  <span class="va">ws</span>,</span>
<span>  <span class="va">wd</span>,</span>
<span>  <span class="va">wd_sd</span>,</span>
<span>  <span class="va">station</span>,</span>
<span>  lon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lonlat_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  print_warnings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  muffle_warnings <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  data_check <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-w">w<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> object of weather station data for
formatting.</p></dd>


<dt id="arg-yyyy">YYYY<a class="anchor" aria-label="anchor" href="#arg-yyyy"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the year when the
weather was logged.</p></dd>


<dt id="arg-mm">MM<a class="anchor" aria-label="anchor" href="#arg-mm"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the month (numerical)
when the weather was logged.</p></dd>


<dt id="arg-dd">DD<a class="anchor" aria-label="anchor" href="#arg-dd"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the day of month when
the weather was logged.</p></dd>


<dt id="arg-hh">hh<a class="anchor" aria-label="anchor" href="#arg-hh"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the hour (24 hour) when
the weather was logged.</p></dd>


<dt id="arg-mm">mm<a class="anchor" aria-label="anchor" href="#arg-mm"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the minute when the
weather was logged.</p></dd>


<dt id="arg-ss">ss<a class="anchor" aria-label="anchor" href="#arg-ss"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the second when the
weather was logged.</p></dd>


<dt id="arg-posixct-time">POSIXct_time<a class="anchor" aria-label="anchor" href="#arg-posixct-time"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> which contains a <code>POSIXct</code>
formatted time. This can be used instead of arguments <code>YYYY</code>, <code>MM</code>, <code>DD</code>,
<code>hh</code>, <code>mm.</code>.</p></dd>


<dt id="arg-time-zone">time_zone<a class="anchor" aria-label="anchor" href="#arg-time-zone"></a></dt>
<dd><p>Time zone (Olsen time zone format) <code>character</code> where the
weather station is located. May be in a column or supplied as a character string.
Optional, see also <code>r</code>. See details.</p></dd>


<dt id="arg-temp">temp<a class="anchor" aria-label="anchor" href="#arg-temp"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>x</code> that refers to temperature in degrees
Celsius.</p></dd>


<dt id="arg-rain">rain<a class="anchor" aria-label="anchor" href="#arg-rain"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to rainfall in millimetres.</p></dd>


<dt id="arg-rh">rh<a class="anchor" aria-label="anchor" href="#arg-rh"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to relative
humidity as a percentage.</p></dd>


<dt id="arg-ws">ws<a class="anchor" aria-label="anchor" href="#arg-ws"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to wind speed in km / h.</p></dd>


<dt id="arg-wd">wd<a class="anchor" aria-label="anchor" href="#arg-wd"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to wind direction in
degrees.</p></dd>


<dt id="arg-wd-sd">wd_sd<a class="anchor" aria-label="anchor" href="#arg-wd-sd"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to wind speed columns
standard deviation.  This is only applicable if weather data
is already summarised to hourly increments. See details.</p></dd>


<dt id="arg-station">station<a class="anchor" aria-label="anchor" href="#arg-station"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to the weather station
name or identifier. See details.</p></dd>


<dt id="arg-lon">lon<a class="anchor" aria-label="anchor" href="#arg-lon"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to weather station's
longitude. See details.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>Column name <code>character</code> or index in <code>w</code> that refers to weather station's
latitude. See details.</p></dd>


<dt id="arg-lonlat-file">lonlat_file<a class="anchor" aria-label="anchor" href="#arg-lonlat-file"></a></dt>
<dd><p>A file path (<code>character</code>) to a <acronym>CSV</acronym> which included station
name/id and longitude and latitude coordinates if they are not supplied in
the data. Optional, see also <code>lon</code> and <code>lat</code>.</p></dd>


<dt id="arg-print-warnings">print_warnings<a class="anchor" aria-label="anchor" href="#arg-print-warnings"></a></dt>
<dd><p>default is <code>TRUE</code>. If <code>FALSE</code>, warnings will not be
printed to the console while aggregating weather data into hourly time
intervals but instead will be captured and exported to object
warn$captured_warnings and can be retrieved with function
<code><a href="check_weather_warnings.html">check_weather_warnings()</a></code>.</p></dd>


<dt id="arg-muffle-warnings">muffle_warnings<a class="anchor" aria-label="anchor" href="#arg-muffle-warnings"></a></dt>
<dd><p>default is <code>FALSE</code>. IF <code>TRUE</code> any warnings or messages
will be muffled and not printed to console. Only use if there is a lot of NA
wind data which you are aware about and happy to ignore.</p></dd>


<dt id="arg-data-check">data_check<a class="anchor" aria-label="anchor" href="#arg-data-check"></a></dt>
<dd><p>If <code>TRUE</code>, it checks for NA values in all 'rain', 'temp',
'rh', 'wd' and 'ws' data and if any values which are unlikely. Use a character
vector of variable names, (wither any of 'rain', 'temp', 'rh', 'wd' or 'ws')
to check data from specific variables. If FALSE it ignores all variables and
could cause subsequent models using this data to fail.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>epiphy.weather</code> object (an extension of <a href="https://CRAN.R-project.org/package=data.table" class="external-link"><span class="pkg">data.table</span></a>)
containing the supplied weather aggregated to each hour in a suitable
format for use with disease models. Depending on the input weather, classes
will be given to the output object to indicate which models it meets the data
requirements for. Some of the columns returned are as follows:</p><table class="table table"><tr><td><strong>times</strong>:</td><td>Time in POSIXct format with "UTC" time-zone</td></tr><tr><td><strong>rain</strong>:</td><td>Rainfall in mm</td></tr><tr><td><strong>temp</strong>:</td><td>Temperature in degrees celcius</td></tr><tr><td><strong>ws</strong>:</td><td>Wind speed in km / h</td></tr><tr><td><strong>wd</strong>:</td><td>Wind direction in compass degrees</td></tr><tr><td><strong>wd_sd</strong>:</td><td>Wind direction standard deviation in compass degrees</td></tr><tr><td><strong>lon</strong>:</td><td>Station longitude in decimal degrees</td></tr><tr><td><strong>lat</strong>:</td><td>Station latitude in decimal degrees</td></tr><tr><td><strong>station</strong>:</td><td>Unique station identifying name</td></tr><tr><td><strong>YYYY</strong>:</td><td>Year</td></tr><tr><td><strong>MM</strong>:</td><td>Month</td></tr><tr><td><strong>DD</strong>:</td><td>Day</td></tr><tr><td><strong>hh</strong>:</td><td>Hour</td></tr><tr><td><strong>mm</strong>:</td><td>Minute</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>time_zone</code> The time-zone in which the <code>time</code> was recorded. All weather
stations in <code>w</code> must fall within the same time-zone.  If the required stations
are located in differing time zones, <code>format_weather()</code> should be run separately
on each object, then data can be combined after formatting.</p>
<p><code>wd_sd</code> If weather data is
provided in hourly increments, a column
with the standard deviation of the wind direction over the hour is required
to be provided. If the weather data are sub-hourly, the standard deviation
will be calculated and returned automatically.</p>
<p><code>lon</code>, <code>lat</code> and <code>lonlat_file</code> If <code>w</code> provides longitude and
latitude values for station locations, these may be specified in the <code>lon</code>
and <code>lat</code> columns.  If the coordinates are not relevant to the study
location <code>NA</code> can be specified and the function will drop these column
variables.  If these data are not included, (<code>NULL</code>) a separate file may be
provided that contains the longitude, latitude and matching station name to
provide station locations in the final <code>epiphy.weather</code> object that is
created by specifying the file path to a <acronym>CSV</acronym> file using
<code>lonlat_file</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Weather data files for Newmarracara for testing and examples have been</span></span></span>
<span class="r-in"><span><span class="co"># included in ascotraceR. The weather data files both are of the same format,</span></span></span>
<span class="r-in"><span><span class="co"># so they will be combined for formatting here.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load the weather data to be formatted</span></span></span>
<span class="r-in"><span><span class="va">scaddan</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"scaddan_weather.csv"</span>,package <span class="op">=</span> <span class="st">"epiphytoolR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">naddacs</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"naddacs_weather.csv"</span>,package <span class="op">=</span> <span class="st">"epiphytoolR"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weather_file_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">scaddan</span>, <span class="va">naddacs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weather_station_data</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">weather_file_list</span>, FUN <span class="op">=</span> <span class="va">read.csv</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weather_station_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">weather_station_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weather_station_data</span><span class="op">$</span><span class="va">Local.Time</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">weather_station_data</span><span class="op">$</span><span class="va">Local.Time</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>,</span></span>
<span class="r-in"><span>              tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="fu">format_weather</span><span class="op">(</span></span></span>
<span class="r-in"><span>   w <span class="op">=</span> <span class="va">weather_station_data</span>,</span></span>
<span class="r-in"><span>   POSIXct_time <span class="op">=</span> <span class="st">"Local.Time"</span>,</span></span>
<span class="r-in"><span>   ws <span class="op">=</span> <span class="st">"meanWindSpeeds"</span>,</span></span>
<span class="r-in"><span>   wd_sd <span class="op">=</span> <span class="st">"stdDevWindDirections"</span>,</span></span>
<span class="r-in"><span>   rain <span class="op">=</span> <span class="st">"Rainfall"</span>,</span></span>
<span class="r-in"><span>   temp <span class="op">=</span> <span class="st">"Temperature"</span>,</span></span>
<span class="r-in"><span>   wd <span class="op">=</span> <span class="st">"meanWindDirections"</span>,</span></span>
<span class="r-in"><span>   lon <span class="op">=</span> <span class="st">"Station.Longitude"</span>,</span></span>
<span class="r-in"><span>   lat <span class="op">=</span> <span class="st">"Station.Latitude"</span>,</span></span>
<span class="r-in"><span>   station <span class="op">=</span> <span class="st">"StationID"</span>,</span></span>
<span class="r-in"><span>   time_zone <span class="op">=</span> <span class="st">"UTC"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>All relative humidity values are 'NA' or missing, check data if this is not intentional</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reformat saved weather</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create file path and save data</span></span></span>
<span class="r-in"><span><span class="va">file_path_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"weather_saved.csv"</span>, sep <span class="op">=</span> <span class="st">"\\"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">weather</span>, file <span class="op">=</span> <span class="va">file_path_name</span>,</span></span>
<span class="r-in"><span>          row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read data back in to</span></span></span>
<span class="r-in"><span><span class="va">weather2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">file_path_name</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># reformat the data to have appropriate column classes and data class</span></span></span>
<span class="r-in"><span><span class="va">weather2</span> <span class="op">&lt;-</span> <span class="fu">format_weather</span><span class="op">(</span><span class="va">weather2</span>,</span></span>
<span class="r-in"><span>                           time_zone <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>All relative humidity values are 'NA' or missing, check data if this is not intentional</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">file_path_name</span><span class="op">)</span> <span class="co"># remove temporary weather file</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Melloy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

